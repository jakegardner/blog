
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Implementing Token-Based Authentication using Angular + Node.js</title>
    <meta name="description" content="">

    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="shortcut icon" href="../favicon.ico">

    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap.min.css?v=546fb4393b">
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="http://fonts.googleapis.com/css?family=Droid+Serif:300,400,700,400italic%7COpen+Sans" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="../assets/css/screen.css?v=546fb4393b">
    <link rel="stylesheet" type="text/css" href="../assets/css/blog.css?v=546fb4393b">

    <link rel="canonical" href="index.html">
    
    <meta property="og:site_name" content="Jake Gardner">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Implementing Token-Based Authentication using Angular + Node.js">
    <meta property="og:description" content="You are building an authenticated Angular application with a REST backend. You need to restrict access to your server. What do you do? Token-based authentication is a very common solution to this problem. Many prominent public API's such as Twitter...">
    <meta property="og:url" content="http://localhost:2368/implement-token-based-authentication-using-angular-node-js/">
    <meta property="article:published_time" content="2015-07-24T11:53:14.495Z">
    <meta property="article:modified_time" content="2015-12-05T05:36:21.889Z">
    <meta property="article:tag" content="node">
    <meta property="article:tag" content="angular">
    <meta property="article:tag" content="token-based auth">
    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Implementing Token-Based Authentication using Angular + Node.js">
    <meta name="twitter:description" content="You are building an authenticated Angular application with a REST backend. You need to restrict access to your server. What do you do? Token-based authentication is a very common solution to this problem. Many prominent public API's such as Twitter...">
    <meta name="twitter:url" content="http://localhost:2368/implement-token-based-authentication-using-angular-node-js/">
    
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "Jake Gardner",
    "author": {
        "@type": "Person",
        "name": "Jake Gardner",
        "url": "http://localhost:2368/author/jake",
        "sameAs": null
    },
    "headline": "Implementing Token-Based Authentication using Angular + Node.js",
    "url": "http://localhost:2368/implement-token-based-authentication-using-angular-node-js/",
    "datePublished": "2015-07-24T11:53:14.495Z",
    "dateModified": "2015-12-05T05:36:21.889Z",
    "keywords": "node, angular, token-based auth",
    "description": "You are building an authenticated Angular application with a REST backend. You need to restrict access to your server. What do you do? Token-based authentication is a very common solution to this problem. Many prominent public API&#x27;s such as Twitter..."
}
    </script>

    <meta name="generator" content="Ghost 0.5">
    <link rel="alternate" type="application/rss+xml" title="Jake Gardner" href="../rss/index.html">
</head>
<body class="post-template tag-node tag-angular tag-token-based-auth">
    <nav class="navbar" role="navigation">
        <div class="container-fluid">
            <div class="row">
                <div class="col-xs-12 col-sm-10 col-sm-offset-1 col-md-8 col-md-offset-2 navbar-header">
                    <span class="navbar-brand">
                        <a href="../"><span class="nav-link">Jake Gardner</span></a>
                    </span>
                    <ul class="navbar-social">
                        <li><a class="social-link" href="https://github.com/jakegardner"><span class="fa fa-github fa-lg fa-fw"></span></a></li>
                        <li><a class="social-link" href="https://twitter.com/jakegardnr"><span class="fa fa-twitter fa-lg fa-fw"></span></a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>
    
    


<main class="post-content" role="main">

    <article class="post tag-node tag-angular tag-token-based-auth">

        <header class="post-header">
            <h1 class="post-title">Implementing Token-Based Authentication using Angular + Node.js</h1>
            <section class="post-meta">
                 on <a href="../tag/node/">node</a>, <a href="../tag/angular/">angular</a>, <a href="../tag/token-based-auth/">token-based auth</a>
            </section>
        </header>

        <section class="post-content">
            <p>You are building an authenticated Angular application with a REST backend. You need to restrict access to your server. What do you do?</p>

<p>Token-based authentication is a very common solution to this problem. Many prominent public API's such as Twitter and Instagram utilize token-based authentication.</p>

<p>But first, you may ask...</p>

<h3 id="whataretokens">What are tokens?</h3>

<p>A token is a server-generated string that is uniquely associated with a user and identifies them as authenticated. The string can encode certain user-specific informated such as username and profile.</p>

<p>When a user makes a request to your server, they can provide their token as proof that the server has verified their access.</p>

<h3 id="whyaretheypreferred">Why are they preferred?</h3>

<p>Previously, session-based authentication was the most popular. It is still used in some scenarios, but is more complicated to configure, scale, and secure. Information about logged-in users must be kept in memory, oftentimes in a database such as <a href="http://redis.io/">Redis</a>. When a request is received, the user's information must be queried in the session database. </p>

<p>There are problems with this approach. If the server crashes, this information is lost. The user must re-authenticate and the server must re-construct the session profile. Also, since session information must be stored for every user, with a high volume of users you can quickly run into memory issues.</p>

<p>Whereas session-based authentication is <em>stateful</em>, token-based authentication follows a <em>stateless</em> paradigm. This just means that the server does not keep any information about users in memory. When a request is received, the token is validated. If it passes, the request is completed and a result returned. If not, the server can return an error. No in-memory database is required.</p>

<p>Authentication is a topic with many, many considerations. If you are looking to understand more of why and how tokens work, check out <a href="https://scotch.io/tutorials/the-ins-and-outs-of-token-based-authentication">this</a> article over on <a href="https://scotch.io/tutorials/the-ins-and-outs-of-token-based-authentication">scotch.io</a>. </p>

<p>Now, let's get into the how-to.</p>

<h3 id="serversidesetupnodejs">Server-side setup (Node.js)</h3>

<p><a href="https://github.com/auth0/node-jsonwebtoken">Node-jsonwebtoken</a> is the de-facto module for token functionality in a node application. </p>

<p>To grab that, you just need to:</p>

<pre><code>npm install --save jsonwebtoken
</code></pre>

<p>In your node server file, add:</p>

<pre><code>var jwt = require('jsonwebtoken');
</code></pre>

<p>You also need to set a json web token 'secret'. This string is used to make the tokens that your server generates unique, so preferably make it complex!</p>

<pre><code>var jwtSecret = 'jsonWebTokensAreAGreatIdea!';
</code></pre>

<p>Now all that's left is to create the token!</p>

<pre><code>var token = jwt.sign('username', jwtSecret, {
    expiresInMinutes: 60
});
</code></pre>

<p>In place of the 'username' string, you could use an object instead. The second parameter is the secret you configured earlier. The last one is an options object (of which <a href="https://www.npmjs.com/package/jsonwebtoken#jwt-sign-payload-secretorprivatekey-options">there are many available</a>); here we just set the expiration time of the token in minutes.</p>

<p>All of the preceding code together in an Express route:</p>

<pre><code>var app = require('express')();
var jwt = require('jsonwebtoken');
var jwtSecret = 'jsonWebTokensAreAGreatIdea!'; 

app.get('/auth', function (req, res) {
  var username = req.query.username;
  var token = jwt.sign(username, jwtSecret, {
    expiresInMinutes: 60
  });

  res.send(token);
});
</code></pre>

<p>Now when  a request is received at <a href="http://yourserver/auth?username=jakeg">http://yourserver/auth?username=jakeg</a>, a token will be signed and returned to the client.</p>

<h3 id="clientsidesetupangular">Client-side setup (Angular)</h3>

<p>On the Angular side, you first need to setup the request to retrieve the token. Here, I will just use $http.get():</p>

<pre><code>$http.get('http://yourserver/auth', { 
    params: { username: 'username' } 
  }).success( function(data, status, headers, config) {
    // save the token for later queries
    localStorage.token = data.token;
  });
</code></pre>

<p>The first parameter to $http.get is the API endpoint that will return the token. The second passes the username within a 'params' object. We save the resulting token in localStorage to persist on the client, but you could pass the token anywhere else in your application deemed appropriate.</p>

<p>If you want to retrieve the information encoded in the token, you need a couple extra functions to parse and decode:</p>

<pre><code>function urlBase64Decode(str) {
  var output = str.replace('-', '+').replace('_', '/');
  switch (output.length % 4) {
    case 0:
      break;
    case 2:
      output += '==';
      break;
    case 3:
      output += '=';
      break;
    default:
      throw 'Illegal base64url string!';
  }
  return window.atob(output);
}

function getClaimsFromToken(token) {
  var response = {};

  if (typeof token !== "undefined") {
    var encoded = token.split(".")[1];
    response = JSON.parse(urlBase64Decode(encoded));
  }
  return response;
}
</code></pre>

<p>The first function decodes the token string using base64. The second takes the chunk containing encoded data and parses it into a JSON object.</p>

<p>To include the token on remote requests (required!), just add it as a parameter. With Angular, you have two options:</p>

<p><a href="https://docs.angularjs.org/api/ng/service/%24http">$http.get()</a></p>

<pre><code>$http.get('http://myapi.com/auth', 
  { params: { username: 'username' } } );
</code></pre>

<p><a href="https://docs.angularjs.org/api/ngResource/service/%24resource">$resource service</a></p>

<pre><code>myResource.bind( { token: localStorage.getItem("token") } );
</code></pre>

<blockquote>
  <p>You can also add it as a HTTP Header parameter. However, this will send your token on every HTTP request your application makes. <em>Only</em> do this if you will only make remote requests to <em>your</em> API. Sending your token elsewhere can interfere with communication and is also giving away keys to your service!</p>
</blockquote>

<p>That's it! Now when you make remote requests, the token your application retrieved earlier will be sent along to authenticate your request.</p>

<h3 id="wrapup">Wrap Up</h3>

<p>Implementing token-based authentication is a good solution toward keeping your application and services secure. And fortunately, the Node and Angular ecosystem makes this fairly simple to setup!</p>
        </section>

        <time class="post-date" datetime="2015-07-24">24 July 2015</time>
        <footer class="post-footer">



            <section class="author">
                <h4><a href="http://localhost:2368/author/jake/">Jake Gardner</a></h4>

                    <p>Read <a href="http://localhost:2368/author/jake/">more posts</a> by this author.</p>
                <div class="author-meta">
                    
                    
                </div>
            </section>


            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="https://twitter.com/share?text=Implementing%20Token-Based%20Authentication%20using%20Angular%20%2B%20Node.js&amp;url=http://localhost:2368/implement-token-based-authentication-using-angular-node-js/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:2368/implement-token-based-authentication-using-angular-node-js/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=http://localhost:2368/implement-token-based-authentication-using-angular-node-js/" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>

        </footer>

    </article>

</main>



    <script src="../public/jquery.js?v=546fb4393b"></script>

    <!-- <script type="text/javascript" src="/assets/js/jquery.fitvids.js?v=546fb4393b"></script>
    // <script type="text/javascript" src="/assets/js/index.js?v=546fb4393b"></script> -->


    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-70122057-1', 'auto');
      ga('send', 'pageview');

    </script>
</body>
